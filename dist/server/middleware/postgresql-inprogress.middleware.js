"use strict";/**
 * @author Frazer Smith
 * @param {Object} pool - Pool object.
 * @return {Function} express middleware
 * @description Query PostgreSQL DB for latest version of in-progress discharge summaries.
 */module.exports=function(a){return function(b,c,d){var e;return regeneratorRuntime.async(function(c){for(;;)switch(c.prev=c.next){case 0:return e=function(){return a.query("WITH CTE\n\t\t\t\t\t\t\t\t\t\t\t\t  AS (SELECT *,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t ROW_NUMBER() OVER (PARTITION BY ID ORDER BY VERSION DESC) AS rn\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFROM public.discharge_summary)\n\t\t\t\t\t\t\t\t\t\t\t  SELECT id, \"lastUpdate\", raw, version\n\t\t\t\t\t\t\t\t\t\t\t\tFROM CTE\n\t\t\t\t\t\t\t\t\t\t\t   WHERE rn = 1\n\t\t\t\t\t\t\t\t\t\t\t\t AND raw->>'patient_mrn' = $1\n\t\t\t\t\t\t\t\t\t\t\tORDER BY id DESC",[b.customparams.patient_mrn]).then(function(a){return a.rows})},c.next=3,regeneratorRuntime.awrap(e().then(function(a){b.customparams.in_progress_discharge_summaries=a,d()})["catch"](function(a){d(a)}));case 3:case"end":return c.stop();}})}};