"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}/**
 * @author Frazer Smith
 * @param {Object} pool - Pool object.
 * @return {Function} express middleware
 * @description Query PostgreSQL DB for latest version of in-progress discharge summaries.
 */module.exports=function(a){return(/*#__PURE__*/function(){var b=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c,d,e){var f;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f=function(){return a.query("WITH CTE\n\t\t\t\t\t\t\t\t\t\t\t\t  AS (SELECT *,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t ROW_NUMBER() OVER (PARTITION BY ID ORDER BY VERSION DESC) AS rn\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFROM public.discharge_summary)\n\t\t\t\t\t\t\t\t\t\t\t  SELECT id, \"lastUpdate\", raw, version\n\t\t\t\t\t\t\t\t\t\t\t\tFROM CTE\n\t\t\t\t\t\t\t\t\t\t\t   WHERE rn = 1\n\t\t\t\t\t\t\t\t\t\t\t\t AND raw->>'patient_mrn' = $1\n\t\t\t\t\t\t\t\t\t\t\tORDER BY id DESC",[c.customparams.patient_mrn]).then(function(a){return a.rows})},b.next=3,f().then(function(a){c.customparams.in_progress_discharge_summaries=a,e()})["catch"](function(a){e(a)});case 3:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())};