"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}var _require=require("pg"),Pool=_require.Pool,postgresqlAwaitingSignOffMiddleware=require("./postgresql-awaitingsignoff.middleware"),_require2=require("../../test.config"),postgresqlConfig=_require2.postgresqlConfig;require("regenerator-runtime"),describe("PostgreSQL DB awaiting sign off middleware",function(){test("Should return a middleware function",function(){var a=postgresqlAwaitingSignOffMiddleware();expect(_typeof(a)).toBe("function")}),test("Should return list of discharge summaries awaiting dr sign off",function(){var a,b,c,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=postgresqlAwaitingSignOffMiddleware(new Pool(postgresqlConfig),"dr"),b={},c={},d=jest.fn(),e.next=6,regeneratorRuntime.awrap(a(b,c,d));case 6:expect(b.awaitingsignoff).not.toBeUndefined(),expect(b.awaitingsignoff.dr).not.toBeUndefined(),expect(d).toHaveBeenCalledTimes(1);case 9:case"end":return e.stop();}})}),test("Should return list of discharge summaries awaiting nurse sign off",function(){var a,b,c,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=postgresqlAwaitingSignOffMiddleware(new Pool(postgresqlConfig),"nurse"),b={},c={},d=jest.fn(),e.next=6,regeneratorRuntime.awrap(a(b,c,d));case 6:expect(b.awaitingsignoff).not.toBeUndefined(),expect(b.awaitingsignoff.nurse).not.toBeUndefined(),expect(d).toHaveBeenCalledTimes(1);case 9:case"end":return e.stop();}})}),test("Should return list of discharge summaries awaiting pharmacy sign off",function(){var a,b,c,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=postgresqlAwaitingSignOffMiddleware(new Pool(postgresqlConfig),"pharmacy"),b={},c={},d=jest.fn(),e.next=6,regeneratorRuntime.awrap(a(b,c,d));case 6:expect(b.awaitingsignoff).not.toBeUndefined(),expect(b.awaitingsignoff.pharmacy).not.toBeUndefined(),expect(d).toHaveBeenCalledTimes(1);case 9:case"end":return e.stop();}})}),test("Should fail if config missing",function(){var a,b,c,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=postgresqlAwaitingSignOffMiddleware(new Pool),b={},c={},d=jest.fn(),e.next=6,regeneratorRuntime.awrap(a(b,c,d));case 6:expect(d.mock.calls[0][0].message.substring(0,30)).toMatch(/^password authentication failed|read ECONNRESET/i),expect(d).toHaveBeenCalledTimes(1);case 8:case"end":return e.stop();}})})});