"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}var _require=require("pg"),Pool=_require.Pool,postgresqlAwaitingSignOffMiddleware=require("./postgresql-awaitingsignoff.middleware"),_require2=require("../../test.config"),postgresqlConfig=_require2.postgresqlConfig;require("regenerator-runtime"),describe("PostgreSQL DB awaiting sign off middleware",function(){test("Should return a middleware function",function(){var a=postgresqlAwaitingSignOffMiddleware();expect(_typeof(a)).toBe("function")}),test("Should return list of discharge summaries awaiting dr sign off",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=postgresqlAwaitingSignOffMiddleware(new Pool(postgresqlConfig),"dr"),c={},d={},e=jest.fn(),a.next=6,b(c,d,e);case 6:expect(c.awaitingsignoff).not.toBeUndefined(),expect(c.awaitingsignoff.dr).not.toBeUndefined(),expect(e).toHaveBeenCalledTimes(1);case 9:case"end":return a.stop();}},a)}))),test("Should return list of discharge summaries awaiting nurse sign off",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=postgresqlAwaitingSignOffMiddleware(new Pool(postgresqlConfig),"nurse"),c={},d={},e=jest.fn(),a.next=6,b(c,d,e);case 6:expect(c.awaitingsignoff).not.toBeUndefined(),expect(c.awaitingsignoff.nurse).not.toBeUndefined(),expect(e).toHaveBeenCalledTimes(1);case 9:case"end":return a.stop();}},a)}))),test("Should return list of discharge summaries awaiting pharmacy sign off",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=postgresqlAwaitingSignOffMiddleware(new Pool(postgresqlConfig),"pharmacy"),c={},d={},e=jest.fn(),a.next=6,b(c,d,e);case 6:expect(c.awaitingsignoff).not.toBeUndefined(),expect(c.awaitingsignoff.pharmacy).not.toBeUndefined(),expect(e).toHaveBeenCalledTimes(1);case 9:case"end":return a.stop();}},a)}))),test("Should fail if config missing",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=postgresqlAwaitingSignOffMiddleware(new Pool),c={},d={},e=jest.fn(),a.next=6,b(c,d,e);case 6:expect(e.mock.calls[0][0].message.substring(0,30)).toMatch(/^password authentication failed|read ECONNRESET/i),expect(e).toHaveBeenCalledTimes(1);case 8:case"end":return a.stop();}},a)})))});