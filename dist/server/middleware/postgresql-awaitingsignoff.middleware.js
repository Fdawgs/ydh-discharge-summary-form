"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}/**
 * @author Frazer Smith
 * @param {Object} pool - Pool object.
 * @param {('dr'|'nurse'|'pharmacy')} signOffType - String specifying type
 * of sign-off that is still needed.
 * @return {Function} express middleware
 * @description Query PostgreSQL DB for discharge summaries awaiting sign-offs.
 */module.exports=function(a,b){return(/*#__PURE__*/function(){var c=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function c(d,e,f){var g,h;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:c.t0=b,c.next="nurse"===c.t0?3:"dr"===c.t0?5:"pharmacy"===c.t0?7:9;break;case 3:return g="AND (raw::jsonb ? 'signoff_nurseFirstCheck' = FALSE OR raw::jsonb ? 'signoff_nurseSecondCheck' = FALSE)",c.abrupt("break",10);case 5:return g="AND (raw::jsonb ? 'signoff_drCheckbox' = FALSE)",c.abrupt("break",10);case 7:return g="AND (raw::jsonb ? 'medication_overallPharmacySignOffCheck' = FALSE) AND (json_array_length(raw->'ttos') IS NOT NULL)",c.abrupt("break",10);case 9:return c.abrupt("break",10);case 10:return h=function(){return a.query("WITH CTE\n\t\t\t\t\t\t\t\t\t\t\t\t  AS (SELECT *,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t ROW_NUMBER() OVER (PARTITION BY ID ORDER BY VERSION DESC) AS rn\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFROM public.discharge_summary)\n\t\t\t\t\t\t\t\t\t\t\t  SELECT id, \"lastUpdate\", raw, version\n\t\t\t\t\t\t\t\t\t\t\t\tFROM CTE\n\t\t\t\t\t\t\t\t\t\t\t   WHERE rn = 1\n\t\t\t\t\t\t\t\t\t\t\t   ".concat(g,"\n\t\t\t\t\t\t\t\t\t\t\tORDER BY id DESC")).then(function(a){return a.rows})},c.next=13,h().then(function(a){d.awaitingsignoff||(d.awaitingsignoff={}),d.awaitingsignoff["".concat(b)]=a,f()})["catch"](function(a){f(a)});case 13:case"end":return c.stop();}},c)}));return function(){return c.apply(this,arguments)}}())};