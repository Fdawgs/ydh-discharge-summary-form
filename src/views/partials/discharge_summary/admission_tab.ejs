<div id="Admission" class="tab-div">
    <div class="full-column">

        <% const encounterList = JSON.parse(encounterresources);
        const admissionDates = {}; 
        
        encounterList.forEach((encounter) => {
            if (encounter.admission_date) {
                const defaultObject = {
                    admission_specialty: '',
                    admission_careProvider: '',
                    admission_method: '',
                    admission_source: '',
                    discharge_specialty: '',
                    discharge_careProvider: '',
                    discharge_method: '',
                    discharge_date: ''
                };
        
                admissionDates[encounter.admission_date.replace('T', ' ')] = Object.assign(defaultObject, encounter);
        
            }
        });%>
        <div class="block">
            <label>
                <h3>Admission Details</h3>
            </label>
        </div>

        <div class="block">
            <label>Admission Date:</label>
            <select class="input" name="admission_date">
                <%
                Object.keys(admissionDates).sort().forEach((admission) => {
                    let attributes = `onclick="changeAdmission('${admissionDates[admission].admission_specialty}',
                        '${admissionDates[admission].admission_method}', '${admissionDates[admission].admission_careProvider}',
                        '${admissionDates[admission].admission_source}', '${admissionDates[admission].discharge_date}',
                        '${admissionDates[admission].discharge_method}', '${admissionDates[admission].discharge_careProvider}');"`;

                    if (typeof admission_date !== 'undefined' && admission_date === admission) {
                        attributes += ' selected';
                    } else {
                        attributes += '';
                    }
                %>
                <option value="<%=admission%>" <%-attributes%>><%=admission%>
                </option>
                <% })
                %>
            </select>
        </div>

        <div class="block">
            <label>Admitting Specialty:</label>
            <input class="input disabled" type="text" name="admission_specialty"
                value="<%- typeof admission_specialty !== 'undefined' ? admission_specialty : '' %>" readonly />
        </div>

        <div class="block">
            <label>Admission Method:</label>
            <input class="input disabled" type="text" name="admission_method"
            value="<%- typeof admission_method !== 'undefined' ? admission_method : '' %>" readonly />
        </div>

        <div class="block">
            <label>Admitting Consultant:</label>
            <input class="input disabled" type="text" name="admission_careProvider"
                value="<%- typeof admission_careProvider !== 'undefined' ? admission_careProvider : '' %>" readonly />
        </div>

        <div class="block">
            <label>Admitting Ward:</label>
            <select class="input" id="admission_ward" name="admission_ward">
                <%  const admissionWardOption = ['', '10', '6A', '6B', '7A', '7B', '8A', '8B', '9A',
                        '9B', 'AAU', 'ACCU', 'AEC', 'CDU(P)', 'DL', 'DYTH', 'EAU', 'ED', 'FAU', 'FREYA',
                        'GYNAE THEATRES', 'ICU', 'JASMINE', 'KW', 'MAIN THEATRES', 'QDH', 'QUEENSWAY'];
                    for (let l = 0; l < admissionWardOption.length; l += 1) {
                        let attributes;

                        if (typeof admission_ward !== 'undefined' && admission_ward === admissionWardOption[l]) {
                            attributes = 'selected';
                        } else {
                            attributes = '';
                        }
                %>
                <option value="<%=admissionWardOption[l]%>" <%-attributes%>><%=admissionWardOption[l]%></option>
                <%
                    }
                %>
            </select>
        </div>

        <div class="block">
            <label>Source of Admission:</label>
            <input class="input disabled" type="text" name="admission_source"
                value="<%- typeof admission_source !== 'undefined' ? admission_source : '' %>" readonly />
        </div>
    </div>
    <% include save_section.ejs %>
</div>